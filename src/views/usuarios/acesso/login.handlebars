<link rel="stylesheet" href="site/css/main.css">
<link rel="stylesheet" href="site/css/bootstrap.min.css">

{{>_msg}}
<body style="background: #FF5A00;">
   <!-- Section -->
   
        <section class="vh-lg-100 d-flex align-items-center">
            <div class="card" style="margin: auto;margin-top:100px;">
                <div class="row justify-content-center form-bg-image" data-background-lg="../../assets/img/illustrations/signin.svg">
                    <div class="col-12 d-flex align-items-center justify-content-center">
                        <div class="signin-inner my-3 my-lg-0 bg-white shadow-soft border rounded border-light p-4 p-lg-5 w-100 fmxw-500">
                            <div class="text-center text-md-center mb-4 mt-md-0">
                               <a href="/"><img src="site/images/logo/logo.svg" style="width: 250px;height:60px;" alt=""></a>
                            </div>
                            <form action="/acessos/login" method="POST" class="mt-4">
                                <!-- Form -->
                                <div class="form-group mb-4">
                                    <label for="email">Digite seu e-mail</label>
                                    <div class="input-group">
                                        <span class="input-group-text" id="basic-addon1"><span class="fas fa-envelope"></span></span>
                                        <input type="email" class="form-control" name="email" id="email" autofocus required>
                                    </div>  
                                </div>
                                <!-- End of Form -->
                                <div class="form-group">
                                    <!-- Form -->
                                    <div class="form-group mb-4">
                                        <label for="senha">Digite sua senha</label>
                                        <div class="input-group">
                                            <span class="input-group-text" id="basic-addon2"><span class="fas fa-unlock-alt"></span></span>
                                            <input type="password"  name="senha" class="form-control" id="senha" required>
                                        </div>  
                                    </div>
                                    <!-- End of Form -->
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <div><a href="#" data-bs-toggle="modal" data-bs-target="#trocarsenha" class="small text-right">Esqueceu sua senha?</a>
                                        </div>
                                    </div>
                                </div>
                                <button type="submit" style="width: 250px;height:40px;background:#262B40;color:white;border:none;border-radius:5px;">Acessar</button>
                            </form>                        
                            <div class="d-flex justify-content-center align-items-center mt-4">
                                <span class="font-weight-normal">
                                    Não registrado?
                                    <a href="/registro" class="font-weight-bold">Crie sua conta</a>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
   
<div class="modal fade" id="trocarsenha" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Trocar Senha</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="form-enviar-confirmacao" action="/acessos/mail-senha" method="POST">
                    <div class="col-md">
                        <div class="form-floating">
                            <input type="text" class="form-control" id="emailtroca" name="emailtroca" placeholder="0">
                            <label for="emailtroca">Digite seu e-mail</label>
                        </div>
                    </div>
                    <button type="submit" id="enviaemail" class="mt-2" style="width: 100px;height:40px;background:#262B40;color:white;border:none;border-radius:5px;">Enviar</button>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="trocarsenha2" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Trocar Senha</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">              
                        <form id="form-confirma-token" action="/acessos/reset-senha" method="POST">
                    <input type="hidden" id="receberemail" name="receberemail">
                    <div class="col-md">
                        <div class="form-floating">
                            <input type="text" class="form-control" id="token" name="token" placeholder="0">
                            <label for="token">Chave recebida</label>
                        </div>
                    </div>
                    <div class="col-md mt-2">
                        <div class="form-floating">
                            <input type="password" class="form-control" id="senhanova" name="senhanova" placeholder="0">
                            <label for="senhanova">Digite sua nova senha</label>
                        </div>
                    </div>
                    <button id="trocasenha"  class="mt-2" style="width: 100px;height:40px;background:#262B40;color:white;border:none;border-radius:5px;">Alterar</button>
                </form>
            </div>
        </div>
    </div>
</div>


</body>
<script>
    $('#form-enviar-confirmacao').submit(() => {      
        let emailtroca = $('#emailtroca').val()
        event.preventDefault()
        jQuery.ajax({
            type: "POST",
            url: '/acessos/mail-senha',
            data: { emailtroca: emailtroca },
            success: function (response) {
                if (response.responseid == 200) {
                    spinngLoading(false)
                    $('#receberemail').val(emailtroca)
                    $('#trocarsenha').modal('hide')
                    $('#trocarsenha2').modal('show')                  
                }
                if (response.responseid == 100) {
                     spinngLoading(false)
                    $(document).ready(() => {
                        Swal.fire({
                            icon: 'error',
                            title: 'Esse e-mail não está cadastrado.',
                            footer: '<a href="/registro">Criar uma conta.</a>',
                            confirmButtonText: 'Ok',
                            allowOutsideClick: false,
                            
                       }).then((result) => {
                            if (result.isConfirmed) {
                                document.location.reload(true);
                            }
                        })
                    })
                }
            }
        });
    })

</script>
<script>
    $('#form-confirma-token').submit(() => {
        let token = $('#token').val()
        let senhanova = $('#senhanova').val()
        let receberemail = $('#receberemail').val()
        event.preventDefault()
        jQuery.ajax({
            type: "POST",
            url: '/acessos/reset-senha',
            data: { receberemail: receberemail, senhanova: senhanova, token: token },
            success: function (response) {
                if (response.responseid == 200) {
                    spinngLoading(false)
                    $(document).ready(() => {
                        Swal.fire({
                            icon: 'success',
                            title: 'Senha alterada com sucesso!',
                            confirmButtonText: 'Ok',
                            allowOutsideClick: false,
                        }).then((result) => {
                            if (result.isConfirmed) {
                                document.location.reload(true);
                            }
                        })

                    })
                }
                if (response.responseid == 100) {
                     spinngLoading(false)
                    $(document).ready(() => {
                        Swal.fire({
                            icon: 'error',
                            title: 'Chave inválida.',
                            allowOutsideClick: false,

                        })
                    })
                }
                if (response.responseid == 125) {
                     spinngLoading(false)
                    $(document).ready(() => {
                        Swal.fire({
                            icon: 'error',
                            title: 'Senha muito curta.',
                            allowOutsideClick: false,

                        })
                    })
                }
            }
        });
    })

</script>
<script>
    var capturando = "";
    function trocarmodal() {
        capturando = document.getElementById('emailtroca').value
        document.getElementById('emailrecebido').innerHTML = capturando;
    }

</script>


{{#if error_msg}}

<script>
    $(document).ready(() => {
        Swal.fire({
            icon: 'error',
            title: '{{error_msg}}',

        })

    })

</script>

{{/if}}

